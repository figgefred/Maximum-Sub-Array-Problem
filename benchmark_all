#!/bin/bash

if  [[ $# < 2 ]] 
then
    echo "Usage: benchmark_all <max_thread> <multiple_increment>"
    echo "Usage: benchmark_all <max_thread> <multiple_increment> <optional_file_input>"
    echo ""
    exit 0
fi

repeat=4

echo "Rebuilding projects..."
echo ""
make clean
make
echo ""
echo "Build complete."
echo ""

benchmark="./benchmark"
input_file="input/test_input_1000.in"
if  [[ $# > 2 ]] 
then
	input_file=$3
fi

ref="bin/ref"
echo "=================================================================="
echo ""
echo "Running reference command ${ref}"
echo ""
eval ${benchmark} ${ref} ${input_file} ${repeat} 1

cmd[0]="bin/thread"
cmd[1]="bin/openmp"

echo 

for((c = 0; c < ${#cmd[@]}; c++))
do
	echo "=================================================================="
	echo ""
	echo "Running benchmark for command ${cmd[$c]}"
	echo ""
	echo "Running single threaded variant..."
	eval ${benchmark} ${cmd[$c]} ${input_file} ${repeat} 1

	if  [[ $1 > 1 ]] 
	then
		echo ""
		echo "Running for threadcount == 2..."
		eval ${benchmark} ${cmd[$c]} ${input_file} ${repeat} 2
	fi

	start=$2
	if  [[ $2 < 3 ]] 
	then
		start=3
	fi

	for (( i = $start; i <= $1 ; i+=$2 ))
	do
		echo ""
		echo "Running for threadcount == ${i}..."
		eval ${benchmark} ${cmd[$c]} ${input_file} ${repeat} ${i}
	done;
done;

echo ""
echo "Done with benchmark for all"

